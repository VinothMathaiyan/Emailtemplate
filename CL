Qualtrics.SurveyEngine.addOnload(function() {
  // Append the calendar button to the free text box
  const inputTextElement = jQuery("#" + this.questionId + " .InputText");

  // Create a container for the date picker
  const datePickerContainer = document.createElement('div');
  datePickerContainer.id = 'date-picker-container';

  // Create the date picker element
  const datePicker = document.createElement('duet-date-picker');
  datePicker.setAttribute('first-day-of-week', '0');
  datePicker.setAttribute('identifier', 'date');

  // Append the date picker to the container
  datePickerContainer.appendChild(datePicker);

  // Insert the date picker container after the input text element
  inputTextElement.after(datePickerContainer);

  // Ensure the calendar popup is displayed correctly
  datePicker.addEventListener('duetOpen', () => {
    const dialog = datePicker.shadowRoot.querySelector('duet-date-picker-dialog');
    jQuery(dialog).css({
      'display': 'block',
      'position': 'absolute',
      'z-index': '9999',
    });
  });

  // Update the input text element with the selected date
  datePicker.addEventListener('duetChange', (event) => {
    inputTextElement.val(event.detail.value);
  });
});
