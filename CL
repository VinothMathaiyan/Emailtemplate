<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qualtrics Calendar</title>
    <!-- jQuery UI CSS -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <!-- jQuery UI JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
</head>
<body>
    <!-- Your HTML content here -->
    <div class="date-container">
        <input type="text" id="day" maxlength="2" placeholder="DD">
        <span class="date-separator">-</span>
        <input type="text" id="month" maxlength="2" placeholder="MM">
        <span class="date-separator">-</span>
        <input type="text" id="year" maxlength="4" placeholder="YYYY">
        <span id="calendarIcon">ðŸ“…</span>
    </div>
    <!-- Your existing script -->
    <script>
        Qualtrics.SurveyEngine.addOnload(function() {
            var dayInput = jQuery("#day");
            var monthInput = jQuery("#month");
            var yearInput = jQuery("#year");
            var calendarIcon = jQuery("#calendarIcon");

            // Initialize datepicker on the hidden input
            var hiddenInput = jQuery('<input type="text" id="datePickerField" style="position: absolute; left: -9999px;">');
            jQuery("body").append(hiddenInput);

            hiddenInput.datepicker({
                dateFormat: 'dd-mm-yy',
                minDate: 0,
                maxDate: "+3M",
                showAnim: "fadeIn",
                showOn: "focus",
                beforeShow: function(input, inst) {
                    var iconOffset = calendarIcon.offset();
                    setTimeout(function() {
                        inst.dpDiv.css({
                            top: iconOffset.top + calendarIcon.outerHeight() + "px",
                            left: iconOffset.left + "px"
                        });
                        inst.dpDiv.attr("tabindex", "-1").focus();
                    }, 10);
                },
                onSelect: function(dateText) {
                    var parts = dateText.split("-");
                    dayInput.val(parts[0]);
                    monthInput.val(parts[1]);
                    yearInput.val(parts[2]);
                    dayInput.focus();
                }
            });

            calendarIcon.on("click", function() {
                hiddenInput.datepicker("show");
                setTimeout(function() {
                    jQuery(".ui-datepicker").attr("tabindex", "0").focus();
                }, 100);
            });

            jQuery(document).on("keydown", function(e) {
                if (jQuery(".ui-datepicker:visible").length) {
                    if (e.key === "Escape") {
                        hiddenInput.datepicker("hide");
                        calendarIcon.focus();
                    }
                }
            });

            dayInput.on("input", function() {
                if (this.value.length === 2) {
                    monthInput.focus();
                }
            });

            monthInput.on("input", function() {
                if (this.value.length === 2) {
                    yearInput.focus();
                }
            });

            jQuery("#day, #month, #year").on("focus", function() {
                jQuery(this).css("outline", "2px solid blue");
            }).on("blur", function() {
                jQuery(this).css("outline", "none");
            });

            yearInput.on("blur", function() {
                var day = dayInput.val();
                var month = monthInput.val();
                var year = yearInput.val();
                var regex = /^(0[1-9]|[12][0-9]|3[01])-(0[1-9]|1[0-2])-\d{4}$/;
                
                if (!regex.test(day + "-" + month + "-" + year)) {
                    alert("Please enter a valid date in dd-mm-yyyy format.");
                    dayInput.val("");
                    monthInput.val("");
                    yearInput.val("");
                }
            });
        });
    </script>
</body>
</html>

