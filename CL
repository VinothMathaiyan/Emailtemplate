# Load the existing Excel file
wb = load_workbook(file_path)

# Function to adjust column width & wrap text
def adjust_excel_format(sheet):
    for col in sheet.columns:
        max_length = 0
        col_letter = col[0].column_letter  # Get column letter
        for cell in col:
            try:
                if cell.value:
                    max_length = max(max_length, len(str(cell.value)))
            except:
                pass
        adjusted_width = min(max_length + 2, 50)  # Max width = 50
        sheet.column_dimensions[col_letter].width = adjusted_width

    # Wrap text for long responses
    for row in sheet.iter_rows():
        for cell in row:
            cell.alignment = Alignment(wrap_text=True)

# Write updated data to Excel & format it
with pd.ExcelWriter(file_path, engine="openpyxl", mode="a", if_sheet_exists="replace") as writer:
    df_1234.to_excel(writer, sheet_name="1234", index=False)
    df_5678.to_excel(writer, sheet_name="5678", index=False)

# Reload workbook to adjust formatting
wb = load_workbook(file_path)
adjust_excel_format(wb["1234"])
adjust_excel_format(wb["5678"])

# Save final formatted file
wb.save(file_path)

print(f"âœ… Processing complete! File updated: {file_path}")
