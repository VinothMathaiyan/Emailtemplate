import json
import pandas as pd

def load_qsf_file(qsf_file):
    with open(qsf_file, 'r', encoding='utf-8-sig') as file:
        data = json.load(file)
    return data

def extract_question_order(data):
    question_order = []
    for element in data['SurveyElements']:
        if 'Payload' in element:
            for key, value in element['Payload'].items():
                if isinstance(value, dict) and 'BlockElements' in value:
                    block_elements = value['BlockElements']
                    for item in block_elements:
                        if 'QuestionID' in item:
                            question_order.append(item['QuestionID'])
    
    print("Question Order:", question_order)  # Debugging line
    return question_order

def save_order_to_excel(question_order, output_file):
    df = pd.DataFrame(question_order, columns=['QuestionID'])
    df.to_excel(output_file, index=False)

if __name__ == "__main__":
    directory = 'd:/Hackaton/EXCELtoQSF'
    
    name = input("Please enter the file name without extension: ")
    qsf_file = f'{directory}/QSF/{name}.qsf'
    output_file = f'{directory}/{name}_order_output.xlsx'
    
    data = load_qsf_file(qsf_file)
    question_order = extract_question_order(data)
    save_order_to_excel(question_order, output_file)
    print(f"Question order has been successfully exported to {output_file}")
