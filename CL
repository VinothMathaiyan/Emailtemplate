Qualtrics.SurveyEngine.addOnload(function() {
    var dayInput = jQuery("#day");
    var monthInput = jQuery("#month");
    var yearInput = jQuery("#year");
    var calendarIcon = jQuery("#calendarIcon");

    function loadjQueryUI(callback) {
        if (typeof jQuery.ui === "undefined") {
            var link = document.createElement("link");
            link.rel = "stylesheet";
            link.href = "https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css";
            document.head.appendChild(link);

            var script = document.createElement("script");
            script.src = "https://code.jquery.com/ui/1.12.1/jquery-ui.min.js";
            script.onload = callback;
            document.head.appendChild(script);
        } else {
            callback();
        }
    }

    loadjQueryUI(function() {
        // Create a hidden input field for the datepicker
        var hiddenInput = jQuery('<input type="text" id="datePickerField" style="position: absolute; left: -9999px;">');
        jQuery("body").append(hiddenInput);

        // Initialize datepicker on the hidden input
        hiddenInput.datepicker({
            dateFormat: 'dd-mm-yy',
            minDate: 0,
            maxDate: "+3M",
            showAnim: "fadeIn",
            showOn: "focus",
            beforeShow: function(input, inst) {
                var iconOffset = calendarIcon.offset();
                setTimeout(function() {
                    inst.dpDiv.css({
                        top: iconOffset.top + calendarIcon.outerHeight() + "px",
                        left: iconOffset.left + "px"
                    });

                    // Ensure keyboard focus on calendar popup
                    inst.dpDiv.attr("tabindex", "-1").focus();
                }, 10);
            },
            onSelect: function(dateText) {
                var parts = dateText.split("-");
                dayInput.val(parts[0]);
                monthInput.val(parts[1]);
                yearInput.val(parts[2]);

                // Move focus back to day input after selection
                dayInput.focus();
            }
        });

        // Show calendar when clicking the icon
        calendarIcon.on("click", function() {
            hiddenInput.datepicker("show");

            // Focus on the calendar to enable keyboard navigation
            setTimeout(function() {
                jQuery(".ui-datepicker").attr("tabindex", "0").focus();
      
