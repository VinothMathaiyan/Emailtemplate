import json
import openpyxl

def extract_question_ids(qsf_file):
    """
    Extracts QuestionIDs from a Qualtrics QSF file and stores them in an Excel file.

    Args:
        qsf_file: Path to the QSF file.

    Returns:
        None
    """

    try:
        with open(qsf_file, 'r') as f:
            qsf_data = json.load(f)

        question_ids = []

        def extract_ids_from_block(block_elements):
            for element in block_elements:
                if 'QuestionID' in element:
                    question_ids.append(element['QuestionID'])
                elif isinstance(element, dict) and 'BlockElements' in element:
                    extract_ids_from_block(element['BlockElements'])

        for survey_element in qsf_data['SurveyElements']:
            payload = survey_element.get('Payload', {})
            for block_id, block_data in payload.items():
                if 'BlockElements' in block_data:
                    extract_ids_from_block(block_data['BlockElements'])

        # Create an Excel workbook and sheet
        workbook = openpyxl.Workbook()
        sheet = workbook.active
        sheet.title = 'Question IDs'

        # Write question IDs to the sheet
        for i, question_id in enumerate(question_ids):
            sheet.cell(row=i+1, column=1, value=question_id)

        # Save the Excel file
        workbook.save('question_ids.xlsx')

    except FileNotFoundError:
        print(f"Error: QSF file '{qsf_file}' not found.")
    except json.JSONDecodeError:
        print(f"Error: Invalid JSON in QSF file '{qsf_file}'.")
    except Exception as e:
        print(f"An unexpected error occurred: {e}")

# Example usage:
qsf_file_path = "QualtricsExported_template_formatted.qsf" 
extract_question_ids(qsf_file_path)
