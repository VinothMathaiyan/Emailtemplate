import pandas as pd
from openpyxl import load_workbook
from openpyxl.styles import PatternFill, Alignment

# Step 1: Filter the rows using pandas
file_path = 'your_file.xlsx'
df = pd.read_excel(file_path)

# List of values to exclude
exclude_values = [
    '${e://Field/pbimg}%',
    '${e://Field/RC}',
    'click to write the question text'
]

# Filter out rows where Column B contains only the specified values
df_filtered = df[~df['B'].isin(exclude_values)]

# Save the filtered DataFrame to a temporary Excel file
filtered_file_path = 'filtered_file.xlsx'
df_filtered.to_excel(filtered_file_path, index=False)

# Step 2: Apply formatting using openpyxl
workbook = load_workbook(filtered_file_path)
sheet = workbook.active

# Set column widths
sheet.column_dimensions['A'].width = 20
sheet.column_dimensions['B'].width = 50  # Adjust as needed
sheet.column_dimensions['C'].width = 30  # Adjust as needed
sheet.column_dimensions['D'].width = 30  # Adjust as needed

# Apply header background color
for cell in sheet[1]:
    cell.fill = PatternFill(start_color='00FF00', end_color='00FF00', fill_type='solid')

# Apply text wrapping to all cells
for row in sheet.iter_rows():
    for cell in row:
        cell.alignment = Alignment(wrap_text=True)

# Save the formatted Excel file
formatted_output_path = 'formatted_filtered_file.xlsx'
workbook.save(formatted_output_path)

print(f"Filtered and formatted file saved to {formatted_output_path}")
