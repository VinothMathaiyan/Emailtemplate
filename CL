import json
import pandas as pd

# Replace 'yourfile.qsf' with your QSF file name
with open('yourfile.qsf', 'r', encoding='utf-8-sig') as file:
    data = json.load(file)

# Extract elements where "Element" is "BL"
bl_elements = [element for element in data['SurveyElements'] if element.get('Element') == 'BL']

# Prepare data for the DataFrame
rows = []
for element in bl_elements:
    payload = element['Payload']
    block_elements = payload.get('BlockElements', [])
    for block_element in block_elements:
        row = {
            'BlockNumber': len(rows) + 1,
            'Type': payload.get('Type', ''),
            'Description': payload.get('Description', ''),
            'BlockElementType': block_element.get('Type', '')
        }
        if 'QuestionID' in block_element:
            row['QuestionID'] = block_element['QuestionID']
        else:
            row['QuestionID'] = ''  # Handle cases where QuestionID is missing
        rows.append(row)

# Convert to DataFrame
df = pd.DataFrame(rows)

# Reorder columns
df = df[['BlockNumber', 'Type', 'Description', 'BlockElementType', 'QuestionID']]

# Save to Excel
df.to_excel('bl_elements_split.xlsx', index=False)

print("Data successfully extracted to 'bl_elements_split.xlsx'")
