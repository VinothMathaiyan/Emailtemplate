Qualtrics.SurveyEngine.addOnload(function() {
  // Append the calendar button to the free text box
  const inputTextElement = jQuery("#" + this.questionId + " .InputText");

  // Create a container for the date picker
  const datePickerContainer = document.createElement('div');
  datePickerContainer.id = 'date-picker-container';

  // Create the date picker element
  const datePicker = document.createElement('duet-date-picker');
  datePicker.setAttribute('first-day-of-week', '0');
  datePicker.setAttribute('identifier', 'date');

  // Append the date picker to the container
  datePickerContainer.appendChild(datePicker);

  // Insert the date picker container after the input text element
  inputTextElement.after(datePickerContainer);

  // Listen for date selection and update the Qualtrics input box
  datePicker.addEventListener('duetChange', (event) => {
    inputTextElement.val(event.detail.value);
  });

  // Add a button to trigger the date picker
  const calendarButton = document.createElement('button');
  calendarButton.type = 'button';
  calendarButton.className = 'icon';
  calendarButton.setAttribute('aria-label', 'Choose Date');
  calendarButton.innerHTML = '<span class="fa fa-calendar-alt fa-2x">&nbsp;</span>';
  inputTextElement.after(calendarButton);

  // Open the date picker when the button is clicked
  calendarButton.addEventListener('click', () => {
    datePicker.focus();
  });
});
