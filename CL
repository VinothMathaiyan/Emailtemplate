import json
import pandas as pd
import re

def load_qsf_file(qsf_file):
    with open(qsf_file, 'r', encoding='utf-8-sig') as file:
        data = json.load(file)
    return data

def extract_question_ids_from_bl(data):
    question_ids = []
    for element in data['SurveyElements']:
        if 'Payload' in element:
            for key, value in element['Payload'].items():
                if isinstance(value, dict) and 'BlockElements' in value:
                    block_elements = value['BlockElements']
                    for item in block_elements:
                        if 'QuestionID' in item:
                            question_ids.append(item['QuestionID'])
    
    print("Extracted Question IDs:", question_ids)  # Debugging line
    return question_ids

def write_to_excel(question_ids, output_file):
    df = pd.DataFrame(question_ids, columns=['QuestionID'])
    df.to_excel(output_file, index=False)

if __name__ == "__main__":
    directory = 'd:/Hackaton/EXCELtoQSF'
    
    name = input("Please enter the file name without extension: ")
    qsf_file = f'{directory}/QSF/{name}.qsf'
    output_file = f'{directory}/{name}_question_ids.xlsx'
    
    data = load_qsf_file(qsf_file)
    question_ids = extract_question_ids_from_bl(data)
    write_to_excel(question_ids, output_file)
    print(f"Question IDs have been successfully exported to {output_file}")
